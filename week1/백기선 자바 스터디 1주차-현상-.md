# JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.

## 1. JVM이란 무엇인가

> Java Virtual Machine 의 약자로 Java Byte Code를 OS에 맞게 해석해주는 역할을 하는 가상머신
> 
- Java Compiler는 .java 파일을 .class라는 Java byte code로 변환

     - Byte 코드는 기계어가 아니기 때문에 OS에서 바로 실행이 안됨

- JVM은 OS가 ByteCode를 이해할 수 있도록 해석해 주는 역할을 함

     - 따라서 JVM은 c언어 같은 네이티브 언어에 비해 속도가 느렸지만 JIT(Just In Time) 컴파일러 

       구현을 통해 단점을 극복

- Byte 코드는 JVM위에서 OS 상관없이 실행된다.

     - JVM은 OS에 독립적이지만 의존적이다.

## 2. 컴파일 하는 방법 & 실행하는 방법

자바 파일이 있는 경로로 cmd 창에서 이동한다.

![pasted image 0](https://user-images.githubusercontent.com/10612909/174467231-2cdad6a5-6336-47b1-8d67-8d53394005a8.png)


입력값 : cd 자바파일경로

1. 명령어 javac를 이용하여 컴파일 과정을 진행한다.

![pasted image 0 (1)](https://user-images.githubusercontent.com/10612909/174467248-8b751385-9306-4cf2-a7df-5cb05c2f2918.png)

입력값 : javac 파일이름.java

자바 파일이 있는 경로로 이동하여 컴파일 하려는 Test.java가 존재한다면 에러 없이 컴파일 되어 기존 존재하지 않은 .class 파일이 생성됩니다.

![pasted image 0 (2)](https://user-images.githubusercontent.com/10612909/174467253-434c1974-1dcc-4adf-b96b-38c8f7e9a779.png)

1. 명령어 java를 이용하여 .class 파일 실행 시키기

![pasted image 0 (3)](https://user-images.githubusercontent.com/10612909/174467266-1c81a198-95d5-4dd8-9121-12505201509a.png)

Test01.java 파일의 소스입니다.

위 과정을 에러 없이 내려왔다면 컴파일이 성공적으로 끝내져서 class 파일이 생성되어 있을 것입니다.

이 파일이 정상적으로 실행이 되었다면 "Hello Java"가 출력될 것으로 예상이 됩니다.

![pasted image 0 (4)](https://user-images.githubusercontent.com/10612909/174467271-510bf4eb-bb58-4f64-9479-2ef81ef7c66c.png)

입력값 : java 파일이름

class 파일이 실행되어 cmd창에 Hello Java가 출력됩니다.

## 3. 바이트코드란 무엇인가

### 바이너리 코드와 바이트 코드

**바이너리 코드**

- 0과 1로 구성되어 있는 코드
- C언어로 작상된 .c 파일을 컴파일한 .obj 파일이 바이너리코드
    - 하지만 .obj 파일만으로 실제 컴퓨터가 이해하여 실행할 수 없다. 이때 필요한 것이 링커로 링커는 여러 개의 코드와 데이터를 모아서 연결하여 메모리에서 실행 가능한 파일로 만드는 역할을 한다.
    - 위 과정이 모두 진행된 후 생성되는 실행 파일이 컴퓨터가 이해 할 수 있는 기계어로 구성

**바이트 코드**

- 0과 1로 구성되어 있는 이진 코드이지만 바이너리 코드와 다르게 가상 머신이 이해할 수 있는 코드
- 사람에게 더 친숙한 고급언어보다는 덜 추상적이지만 기계어보다는 추상적이다.
- 컴퓨터가 이해할 수 있는 기계어로 만들기 위해서는 인터프리터의 도움이 필요하다.

## 4. JIT 컴파일러란 무엇이며 어떻게 동작하는가

### JIT = Just In Time

프로그램을 실행할 때마다 컴퓨터가 알아 들을 수 있는 언어로 변환하는 방식인 인터프리트 방식과 실행하기 전에 컴퓨터가 알아 들을 수 있는 언엉로 변환하는 작업을 미리 실행하는 컴파일 방식이 있다. 따라서 인터프리트 방식은 성능이 느릴 수 밖에 없다.

JIT은 이 두 가지 방식을 혼합한 것이다. 변환 작업은 인터프리터에 인해서 지속적으로 수행되지만 필요한 코드의 정보는 캐시에 담아두었다가(메모리에 담아두었다가) 재사용하게 된다.

javac 명령어로 바이트코드로 컴파일하면 JVM에서 JIT컴파일러로 컴퓨터가 알아 들을 수 있게 기계코드로 변환하는 것이다.

![Untitled](https://user-images.githubusercontent.com/10612909/174467305-fcf8b7b2-6020-4fd3-b6f8-7f1a95966e20.png)

## 5. JVM 구성요소

![Untitled (1)](https://user-images.githubusercontent.com/10612909/174467311-f8e8ae8e-a49c-4648-9338-97b707133cb8.png)

클래스 로더가 컴파일된 자바 바이트코드를 런타임 데이터 영역에 로드하고, 실행 엔진이 자바 바이트코드를 실행한다.

### 클래스로더

컴파일타임이 아니라 런타임에 클래스를 처음으로 참조할 때 해당 클래스를 로드하고 링크하는 특징이 있다. 이 동적 로드를 담당하는 부분이 JVM의 클래스 로더이다.

### 런타임 데이터 영역

런타임 데이터 영역은 JVM이라는 프로그램이 운영체제 위에서 실행되면서 할당받는 메모리 영역이다. 런타임 데이터 영역은 6개의 PC 레지스터, JVM 스택, 네이티브 메서드 스택힙, 메서드 영역, 런타임 상수 풀 영역으로 나눌 수 있다.

### 실행엔진

클래스 로더를 통해 JVM 내의 런타임 데이터 영역에 배치된 바이트코드는 실행 엔진에 의해 실행된다. 실행 엔진은 자바 바이트코드를 명령어 단위로 읽어서 실행한다.

## 6. JDK와 JRE의 차이

JDK : Java Development Kit

- 개발에 필요한 여러가지 툴을 제공하는 프로그램이다

JRE : Java Runtime Environment

- 바이트 코드로 컴파일 된 자바 프로그램을 실행할 때 사용

자바 11 부터는 JDK에 JRE 가 포함되어 있기에 과거와 다르게 JDK만 설치해도 무관하다.
